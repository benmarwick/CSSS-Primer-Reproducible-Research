Reproducible Research: A primer for the social sciences
========================================================
author: Ben Marwick
date: February 2014
---
ext_widgets : {rCharts: libraries/nvd3}
---

Overview
========================================================
- Definitions, motives, history, spectrum
- Current practices
- A selection of tools to improve reproducibility 
- Challenges, standards & our role in the future of reproducible research

Definitions
========================================================

*Replicable* refers to the ability to produce **exactly** the same results as published. Other people get exactly the same results when doing exactly the same thing. Technical: cf. validation and verification

*Reproducible* refers to the ability to create a code that independently upholds the published results using the information provided. Checking the results from the fixed digital form of data and code from the original study. Something similar happens in other people's hands. Substantive: possibly by a new implementation

><small>"The goal of reproducible research is to tie specific instructions to data analysis and experimental data so that scholarship can be recreated, better understood and verified." <small>- Max Kuhn, CRAN Task View: Reproducible Research</small></small>

History of reproducible research
=======================================================
- Write scientiﬁc paper [1660?]
- Publish a pidgin algorithm and describe simulation datasets [1950?]
- Sell magtape of code and data [1970?]
- Place idiosyncratic dataset & software at website [1991?]
- Publish datasets and scripts at website [2000?]
- Hosted & integrated code and data [2020?]

<small>Gavish & Gonoho AAAS 2011</small>

Motivations
========================================================

>"An article about computational result is advertising, not scholarship. The actual scholarship is the full software environment, code and data, that produced the result." <small><small>- Claerbout and Karrenbach, Proceedings of the 62nd Annual International Meeting of the Society of Exploration Geophysics. 1992</small></small>

>"When we publish articles containing figures which were generated by computer, we also publish the complete software environment which generates the figures" <small><small>- Buckheit & Donoho, Wavelab and Reproducible Research, 1995.</small></small>

Benefits
=======================================================
- Verification & Reliability: Easier to find and fix bugs. The results you produce today will be the same results you will produce tomorrow.
- Transparency: Leads increased citation count, broader impact, improved institutional memory
- Efficiency: Reuse allows for de-duplication of effort. Payoff in the (not so) long run
- Flexibility: When you don’t 'point-and-click' you gain many new analytic options.

Limitations
=======================================================
Technical
- Classified or sensitive data
- Nondisclosure agreements
- Intellectual property 
- Software licensing issues
- Neither necessary nor sufficient for correctness (but essential for dispute resolution)

***

Cultural & personal 
- Very few researchers follow even minimal reproducibility standards.
- No-one expects or requires reproducibility 
- No uniform standards of reproducibility, so no established user base
- Inertia & embarassment

There is a spectrum of reproducibility
=======================================================
![alt text](figures/peng-spectrum.jpg)
<small>Peng 2011, Science 334(6060) pp. 1226-1227</small>

Bring the reader futher into the research pipeline
=======================================================
![alt text](figures/peng-pipeline.jpg)
<small>http://www.stodden.net/AMP2011/slides/pengslides.pdf</small>

Current practices
========================================================
type: alert

Common practice in the social sciences
========================================================
- Enter data in Excel
- Use Excel for data cleaning & descriptive statistics
- Import data into SPSS/SAS/Stata for further analysis
- Use point-and-click options to run statistical analyses
- Copy & paste output to Word document, repeatedly

***

- Excel handles missing data inconsistently and sometimes incorrectly 
- Excel uses poor algorithms for many functions
- Scripting is possible but rare 
- Version control is ad hoc

========================================================
incremental: true
![alt text](figures/lemon.png)

***

![alt text](figures/phd-comic-vcs.gif)

Click trails are ephemeral & dangerous
========================================================
- Lots of human effort for tedious & time-wasting tasks
- Error-prone due to manual & ad hoc data handling
- Column and row offsets are common
- Difficult to record -  hard to reconstruct a 'click history'
- Tiny changes in data require extensive reworking efforts

***

![alt text](figures/contrails.jpg)

Case study: Reinhart and Rogoff controversy
========================================================
`
`

- Claimed that higher debt-to-G.D.P. ratios are associated with lower levels of G.D.P. growth
- Identified the threshold to -ve growth at a debt-to-G.D.P. ratio of >90%
- Substantial impact on autsterity politics 
- Reanalysis identified no threshold and +2.2% at >90%

***

![alt text](figures/reinhart_rogoff_coding_error_0.png)

Case study: Reinhart and Rogoff controversy
========================================================
<img src="figures/reinhart_rogoff_econ_mag.png" alt="alt text" width="800">


Scripted analyses endure
========================================================


![alt text](figures/open-science.png)

***

- Plain text files and UTF-8 encoding will be readable for a long time
- Improved transparency, automation, maintanability, accessibility, standardisation, modularity, portability, efficiency, communicability of process (what more could you want?)
- But there's a steep learning curve 

A selection of tools
========================================================
type: alert

Literate statistical programming 
========================================================
>"Instead of imagining that our main task is to instruct a computer what to do, let us concentrate rather on explaining to humans what we want the computer to do."-- Donald E. Knuth, Literate Programming, 1984

***

For example...
Let's calculate the current time in R.

```r
time <- format(Sys.time(), "%a %b %d %X %Y")
```

The text and R code are interwoven in the output:

The time is `` `r time` ``

The time is Tue Feb 25 2:18:46 AM 2014

Advantages and disadvantages
========================================================
Advantages of switching to literate programming
- Text and code all in one place, in logical order
- Data, results automatically updated to reflect external changes
- Automatic test when building document

Some disadvantages
- Text and code all in one place; can be hard to read sometimes, especially if there is a lot of code
- Can substantially slow down the processing of documents
(although caching can help)

Need a programming language
========================================================
Machine-readable

R: Free, open source, cross-platform, highly interactive, huge user community in academica and private sector

R packages: an ideal 'Compendium'?

![alt text](figures/r-project.jpg)

***

>"both a container for the different elements that make up the document and its computations (i.e. text, code, data, etc.), and as a means for distributing, managing and updating the collection... allow us to move from an era of advertisement to one where our scholarship itself is published" <small>- Gentleman and Temple Lang 2004</small>

Very low barrier to documentation of code with roxygen2
========================================================

<img src="figures/roxygen2.jpg" alt="alt text" width="800">

Need a document formatting language
========================================================

<img src="figures/markdown.png" alt="alt text" width="400">

Markdown: lightweight, human-readable document formatting syntax
based on email text formatting (ie. LaTeX-lite-for-non-CS-people)

***

R Markdown: 
- minor extensions to allow R code display and execution
- embed images in html files (convenient for sharing)
- equations

One package to rule them all
========================================================
knitr - descendant of Sweave

<img src="figures/knitr.png" alt="alt text" width="400">


***

- 'dynamic documents' put narrative and code in the same file
- When data or narrative are updated, the document is automatically updated
- Data treated as 'read only'
- Output treated as disposable

Use Pandoc to generate output from RStudio in many popular formats
========================================================
`
`

A universal document converter, open source, cross-platform

Easily convert markdown file to many formats (HTML, PDF, DOCX, etc)

In R, write code and narrative in R Markdown -> use knitr to get Markdown (with figures and results) -> use pandoc to get PDF/DOCX

***
`
`

![alt text](figures/pandoc-workflow-rmd-md.png)

Version control: Track changes for code
========================================================
Payoffs
- Eases collaboration
- Can track changes in any file type (ideally plain text), and who made them
- Can revert file to any point in its tracked history

Costs
- Unfamiliar to most social scientists 
- Takes time to master

***

![alt text](figures/git.png)
![alt text](figures/github.png)
![alt text](figures/bitbucket.png)

Environment for reproducible research
========================================================
RStudio is a free, open source, cross-platform integrated development environment for R

Has an integrated R console, deep support for markdown and git, a file manager, a text editor, a workspace browser, a data viewer, package development tools, etc. etc.

RStudio 'projects' make version control & document preparation simple

***

![alt text](figures/rstudio.png)

Interactive charts in the browser with the rCharts package
========================================================
<iframe src='
CSSS_WI14_Reproducibility-figure/nvd3plot1.html
' scrolling='no' seamless class='rChart 
nvd3
 '
id=iframe-
chart1c8c663c7b70
></iframe>
<style>iframe.rChart{ width: 100%; height: 400px;}</style>


Interactive charts in the browser with the rCharts package
========================================================
<iframe src='
CSSS_WI14_Reproducibility-figure/nvd3plot2.html
' scrolling='no' seamless class='rChart 
nvd3
 '
id=iframe-
chart1c8c78341ee
></iframe>
<style>iframe.rChart{ width: 100%; height: 400px;}</style>


Interactive notebook in the browser, iPython-style
========================================================
```
library(rCharts)
open_notebook()
```

RCloud, another iPython-style R notebook
========================================================
<img src="figures/rcloud.png" alt="alt text" width="800">


Depositing code and data
========================================================
Payoffs
- Free space for hosting (and paid options)
- Assignment of persistent DOIs
- Tracking citation metrics 

Costs
- Sometimes license restrictions (CC-BY & CC0)
- Limited or no private storage space

***
![alt text](figures/figshare.png)
![alt text](figures/dryad.png)

A Hierarchy of Reproducibility 
========================================================
- **Good**: Use an integrated development environment (IDE). Keep your code in one place, let it do what it’s supposed to (RStudio)
- **Better**: Use version control. Help yourself keep track of changes, fix bugs and improve project management (RStudio & Git & GitHub or BitBucket)
- **Best**: Use embedded narrative and code to explicitly link code, text and data, save yourself time, save reviewers time, improve your code. (RStudio & Git & GitHub or BitBucket & R Markdown & knitr & data repository)

Problems, standards & our role in the future
========================================================
type: alert

Ongoing problems
========================================================
- Keeping detailed enough records is hard
- Reproducing big data/compute research is hard
- Making sure that source code works on other people's computers
is hard (but not really our job - most licenses absolve us)
- Technology for data and figures URIs not yet widely available 
- All of this is time consuming and distracts from what our culture currently values most - more publication!

========================================================
<img src="figures/VictoriaStoddenIASSISTJune2010-reasons.png" alt="alt text" width="800">
<small><small><small>Stodden (IASSIST 2010) sampled American academics registered at the Machine Learning conference NIPS (134 responses from 593 requests (23%). Red = communitarian norms, Blue = private incentives</small></small></small>

========================================================
<img src="figures/VictoriaStoddenIASSISTJune2010-reasons-to.png" alt="alt text" width="800">
<small><small><small>Stodden (IASSIST 2010) sampled American academics registered at the Machine Learning conference NIPS (134 responses from 593 requests (23%). Red = communitarian norms, Blue = private incentives</small></small></small>

Standards
========================================================
- Schwab et al.: ER (Easily reproducible), CR (Conditionally reproducible), NR (Not reproducible)
- _Biostatistics_ kite-marking of articles (Peng 2009): D (data), C (code), R (both)
- Reproducible Research Standard (Stodden 2009), scientists should release 
 - The full compendium on the internet
 - Media such as text, figures, tables with Creative Commons Attribution license (CC-BY) 
 - Code with one of Apache 2.0, MIT, LGPL, BSD, etc.
 - Original "selection and arrangement" of data with CC0 or CC-BY

Future of Reproducible Research is Stodden's Standard
========================================================
- Promote culture change through positive attribution 
- Implement mechanisms to indicate & encourage **degrees of compliance** (ie. easily identifiable logo & clear definitions for different levels of reproducibility):
 - **'Reproducible'**: compendium of text-code-data online
 - **'Reproduced'**: compendium available and independently reproduced 
 - **'Semi-Reproducible'**: when the full compendium is not released
 - **'Semi-Reproduced'**: independent reproduction with other data
 - **'Perpetually Reproducible'**: streaming data
 
Our role in the future of Reproducible Research
========================================================
incremental: true
- Train students by putting homework, assignments & dissertations on the Reproducible Research Standard spectrum
- Publish examples of reproducible research in our field
- Request code & data when reviewing
- Submit to & review for journals that support reproducible research
- Critically review & audit data management plans in grant proposals
- Consider reproducibility wherever possible in hiring, promotion & reference letters.

Thanks! 
========================================================
>"Abandoning the habit of secrecy in favor of process transparency and peer review was the crucial step by which alchemy became chemistry." <small><small>-Raymond, E. S., 2004, The art of UNIX programming: Addison-Wesley.</small></small>


Colophon
========================================================
Presentation written in Markdown (R Presentation)

Compiled into HTML5 using RStudio

Source code hosting:
https://github.com/benmarwick/CSSS-Primer-Reproducible-Research

ORCID: http://orcid.org/0000-0001-7879-4531

Licensing: 

* Presentation: CC-BY-3.0 

* Source code: MIT 

References
========================================================
See Rpres file for full references



